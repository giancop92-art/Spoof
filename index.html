<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#0f172a" />
  <title>Chef Academy - Classic Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&display=swap" rel="stylesheet" />
  <style>
    body { 
      font-family: 'Plus Jakarta Sans', sans-serif; 
      background: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%); 
      color: #1e293b; touch-action: none; overflow: hidden; 
    }
    
    /* Menu Laterale */
    #side-menu {
      position: fixed; top: 0; left: 0; width: 280px; height: 100%;
      background: #0f172a; z-index: 200; transform: translateX(-100%);
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 20px 0 50px rgba(0,0,0,0.3);
    }
    #side-menu.open { transform: translateX(0); }
    #menu-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 150; display: none; backdrop-filter: blur(4px); }

    /* Pagine */
    .page { position: absolute; inset: 0; display: none; flex-direction: column; }
    .page.active { display: flex; }

    /* Header Circular Progress */
    .hero-circle { position: relative; width: 80px; height: 80px; background: #1e293b; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 4px solid #334155; }
    .progress-ring { position: absolute; transform: rotate(-90deg); }
    .progress-ring__circle { stroke: #fbbf24; stroke-dasharray: 251.2; stroke-dashoffset: 251.2; stroke-linecap: round; transition: stroke-dashoffset 0.3s ease; }

    /* Righello */
    .ruler-container { position: relative; width: 100%; height: 80px; overflow: hidden; background: rgba(255,255,255,0.5); border-top: 1px solid rgba(0,0,0,0.05); }
    .ruler-track { display: flex; align-items: flex-end; height: 100%; position: absolute; left: 50%; will-change: transform; }
    .tack { width: 2px; background: #cbd5e1; margin-right: 16px; flex-shrink: 0; height: 15px; }
    .tack.major { height: 35px; background: #94a3b8; position: relative; }
    .tack.major::after { content: attr(data-val); position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 9px; font-weight: 800; color: #64748b; }

    /* Sezioni Richiudibili */
    .collapsible-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
    .collapsible-content.open { max-height: 500px; overflow-y: auto; }

    /* Cards */
    .grid-item { background: white; border-radius: 1.25rem; padding: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: all 0.2s; border: 2px solid transparent; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
    .grid-item.active { border-color: #fbbf24; background: #fffbeb; transform: scale(0.95); }

    /* Drag & Delete Zone */
    #drop-delete-zone { position: fixed; top: 0; width: 100%; height: 100px; background: #fef2f2; border-bottom: 3px dashed #ef4444; z-index: 100; transform: translateY(-100%); display: flex; flex-direction: column; align-items: center; justify-content: center; transition: transform 0.3s; }
    #drop-delete-zone.visible { transform: translateY(0); }

    .no-scrollbar::-webkit-scrollbar { display: none; }
  </style>
</head>
<body>

  <div id="menu-overlay" onclick="toggleMenu()"></div>
  <nav id="side-menu" class="p-8 text-white">
      <h2 class="text-2xl font-black text-amber-500 mb-8 italic">CHEF ACADEMY</h2>
      <div class="space-y-4">
          <button onclick="switchPage('bilancia')" class="w-full flex items-center p-4 rounded-2xl bg-amber-500 text-slate-900 font-bold">‚öñÔ∏è Bilancia Classic</button>
          <button onclick="switchPage('convertitore')" class="w-full flex items-center p-4 rounded-2xl hover:bg-slate-800 text-slate-300 font-bold">üç≥ Cotto vs Crudo</button>
      </div>
  </nav>

  <div id="page-bilancia" class="page active">
      <div id="drop-delete-zone">
          <span class="text-3xl mb-1">üóëÔ∏è</span>
          <span class="text-[10px] font-black text-red-600 uppercase tracking-widest">Rilascia per eliminare</span>
      </div>

      <header class="p-5 flex justify-between items-center">
          <button onclick="toggleMenu()" class="p-3 bg-white/80 rounded-2xl shadow-sm active:scale-90 transition-transform">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M4 6h16M4 12h16M4 18h16"></path></svg>
          </button>
          <span class="text-[10px] font-black uppercase tracking-[0.3em] opacity-40 text-slate-600">Smart Scale Pro</span>
          <div class="w-12"></div>
      </header>

      <main class="flex-1 overflow-y-auto no-scrollbar px-5 space-y-4 pb-10">
          
          <div class="bg-slate-900 rounded-[2.5rem] p-6 text-white flex items-center justify-between h-40 shadow-xl">
              <div class="hero-circle flex-shrink-0">
                  <svg class="progress-ring" width="80" height="80"><circle id="mainRing" class="progress-ring__circle" stroke-width="5" fill="transparent" r="36" cx="40" cy="40"/></svg>
                  <span id="mainEmoji" class="text-4xl z-10">ü•Ñ</span>
              </div>
              <div class="flex-1 px-4">
                  <div class="flex items-baseline leading-none">
                      <span id="intDisplay" class="text-6xl font-black tracking-tighter">0</span>
                      <span id="toolLabel" class="text-[10px] text-slate-500 uppercase font-bold ml-2">Cucchiaio</span>
                  </div>
                  <p id="kcalDisplay" class="text-amber-500 text-[11px] font-black uppercase mt-2">0 KCAL</p>
              </div>
              <button onclick="saveFavorite()" class="bg-amber-500 text-slate-900 p-4 rounded-full shadow-lg active:scale-90 transition-all">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M12 6v12m6-6H6"></path></svg>
              </button>
          </div>

          <div class="space-y-2">
              <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-2">I tuoi salvati</h3>
              <div id="favoritesList" class="flex space-x-3 overflow-x-auto no-scrollbar min-h-[70px] items-center py-1">
                  <p class="text-[9px] text-slate-400 italic ml-2">Nessun salvataggio...</p>
              </div>
          </div>

          <div class="bg-white/40 rounded-[2rem] p-2">
              <button onclick="toggleCollapse('food-section')" class="w-full flex justify-between items-center p-4">
                  <span class="text-xs font-black uppercase tracking-widest">ü•¶ Seleziona Alimento</span>
                  <span id="food-section-icon">‚ñº</span>
              </button>
              <div id="food-section" class="collapsible-content open">
                  <div class="grid grid-cols-3 gap-2 p-2" id="foodGrid"></div>
              </div>
          </div>

          <div class="bg-white/40 rounded-[2rem] p-2">
              <button onclick="toggleCollapse('tool-section')" class="w-full flex justify-between items-center p-4">
                  <span class="text-xs font-black uppercase tracking-widest">üìè Tipo di Dosatore</span>
                  <span id="tool-section-icon">‚ñ∂</span>
              </button>
              <div id="tool-section" class="collapsible-content">
                  <div class="grid grid-cols-3 gap-2 p-2" id="toolGrid"></div>
              </div>
          </div>

      </main>

      <footer class="bg-white/80 backdrop-blur-md border-t border-slate-200 pb-8">
          <div class="flex justify-between items-center p-5">
              <button onclick="resetGrams()" class="text-[10px] font-black text-red-500 uppercase bg-red-50 px-4 py-2 rounded-xl">Reset</button>
              <div class="text-4xl font-black text-slate-800 tracking-tighter"><span id="gramsDisplay">0</span><span class="text-sm text-amber-500 ml-1">G</span></div>
              <div class="w-10"></div>
          </div>
          <div class="ruler-container" id="ruler">
              <div class="absolute left-1/2 -translate-x-1/2 bottom-0 w-1.5 h-12 bg-amber-500 z-30 rounded-t-full shadow-lg"></div>
              <div class="ruler-track" id="track"></div>
          </div>
      </footer>
  </div>

  <div id="page-convertitore" class="page bg-white">
      <header class="p-6"><button onclick="toggleMenu()" class="p-3 bg-slate-100 rounded-2xl">‚óÄ Indietro</button></header>
      <div class="flex-1 flex items-center justify-center font-bold text-slate-400 uppercase tracking-widest">In fase di calibrazione...</div>
  </div>

  <script>
    const db = {
      farina:   { name: "Farina",   emoji: "üåæ", w: { cucchiaio: 12, cucchiaino: 4, tazzina: 60,  bicchiere: 120 }, kcal: 364 },
      olio:     { name: "Olio",     emoji: "ü´í", w: { cucchiaio: 9,  cucchiaino: 3, tazzina: 80,  bicchiere: 180 }, kcal: 884 },
      zucchero: { name: "Zucchero", emoji: "üç¨", w: { cucchiaio: 15, cucchiaino: 5, tazzina: 80,  bicchiere: 180 }, kcal: 387 },
      sale:     { name: "Sale",     emoji: "üßÇ", w: { cucchiaio: 18, cucchiaino: 6, tazzina: 110, bicchiere: 250 }, kcal: 0 },
      riso:     { name: "Riso",     emoji: "üçö", w: { cucchiaio: 20, cucchiaino: 7, tazzina: 90,  bicchiere: 220 }, kcal: 130 },
      latte:    { name: "Latte",    emoji: "ü•õ", w: { cucchiaio: 15, cucchiaino: 5, tazzina: 70,  bicchiere: 200 }, kcal: 64 },
      miele:    { name: "Miele",    emoji: "üçØ", w: { cucchiaio: 21, cucchiaino: 7, tazzina: 120, bicchiere: 300 }, kcal: 304 },
      burro:    { name: "Burro",    emoji: "üßà", w: { cucchiaio: 14, cucchiaino: 5, tazzina: 90,  bicchiere: 210 }, kcal: 717 },
      cacao:    { name: "Cacao",    emoji: "üç´", w: { cucchiaio: 8,  cucchiaino: 3, tazzina: 45,  bicchiere: 90 },  kcal: 228 }
    };

    const tools = [
        { id: 'cucchiaio',  name: 'Cucchiaio', emoji: 'ü•Ñ' },
        { id: 'cucchiaino', name: 'Piccolo',   emoji: 'üç¥' },
        { id: 'tazzina',    name: 'Tazzina',   emoji: '‚òï' },
        { id: 'bicchiere',  name: 'Bicchiere', emoji: 'ü•É' },
        { id: 'tazza',      name: 'Mug',       emoji: 'ü•õ' },
        { id: 'pugno',      name: 'Pugno',     emoji: '‚úä' }
    ];

    let state = { food: 'farina', tool: 'cucchiaio', grams: 0, favorites: [] };
    let currentX = 0, prevGrams = 0;

    function toggleMenu() {
        const m = document.getElementById('side-menu');
        const o = document.getElementById('menu-overlay');
        const isOpen = m.classList.contains('open');
        m.classList.toggle('open');
        o.style.display = isOpen ? 'none' : 'block';
    }

    function switchPage(p) {
        document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
        document.getElementById('page-' + p).classList.add('active');
        toggleMenu();
    }

    function toggleCollapse(id) {
        const el = document.getElementById(id);
        const icon = document.getElementById(id + '-icon');
        const isOpen = el.classList.contains('open');
        
        // Chiudi tutti gli altri se vuoi effetto fisarmonica
        // document.querySelectorAll('.collapsible-content').forEach(c => c.classList.remove('open'));

        el.classList.toggle('open');
        icon.innerText = isOpen ? '‚ñ∂' : '‚ñº';
    }

    function init() {
        // Popola Alimenti
        const fGrid = document.getElementById('foodGrid');
        Object.keys(db).forEach(k => {
            const div = document.createElement('div');
            div.className = `grid-item ${k === state.food ? 'active' : ''}`;
            div.onclick = () => {
                state.food = k;
                document.querySelectorAll('#foodGrid .grid-item').forEach(i => i.classList.remove('active'));
                div.classList.add('active');
                updateUI();
            };
            div.innerHTML = `<span class="text-2xl mb-1">${db[k].emoji}</span><span class="text-[8px] font-bold uppercase truncate w-full text-center">${db[k].name}</span>`;
            fGrid.appendChild(div);
        });

        // Popola Dosatori
        const tGrid = document.getElementById('toolGrid');
        tools.forEach(t => {
            const div = document.createElement('div');
            div.className = `grid-item ${t.id === state.tool ? 'active' : ''}`;
            div.onclick = () => {
                state.tool = t.id;
                document.querySelectorAll('#toolGrid .grid-item').forEach(i => i.classList.remove('active'));
                div.classList.add('active');
                document.getElementById('mainEmoji').innerText = t.emoji;
                document.getElementById('toolLabel').innerText = t.name;
                updateUI();
            };
            div.innerHTML = `<span class="text-2xl mb-1">${t.emoji}</span><span class="text-[8px] font-bold uppercase">${t.name}</span>`;
            tGrid.appendChild(div);
        });

        // Righello
        const track = document.getElementById('track');
        for(let i=0; i<=500; i++) {
            const t = document.createElement('div');
            t.className = i%10===0 ? 'tack major' : 'tack';
            if(i%10===0) t.setAttribute('data-val', i);
            track.appendChild(t);
        }
        setupRuler();
        updateUI();
    }

    function setupRuler() {
        const r = document.getElementById('ruler');
        let startX = 0, isDown = false;
        r.ontouchstart = (e) => { isDown = true; startX = e.touches[0].clientX - currentX; };
        window.addEventListener('touchmove', (e) => {
            if (!isDown) return;
            let x = e.touches[0].clientX - startX;
            if (x > 0) x = 0;
            currentX = x;
            state.grams = Math.abs(Math.round(x/16));
            if(state.grams !== prevGrams) {
                if(navigator.vibrate) navigator.vibrate(5);
                prevGrams = state.grams;
                updateUI();
            }
        }, { passive: false });
        window.addEventListener('touchend', () => isDown = false);
    }

    function updateUI() {
        const f = db[state.food];
        const tw = f.w[state.tool] || 15;
        const units = state.grams / tw;
        const perc = (units % 1) * 100;

        document.getElementById('intDisplay').innerText = Math.floor(units);
        document.getElementById('gramsDisplay').innerText = state.grams;
        document.getElementById('track').style.transform = `translateX(${currentX}px)`;
        document.getElementById('kcalDisplay').innerText = Math.round((f.kcal * state.grams) / 100) + " KCAL";

        const offset = 251.2 - ((perc === 0 && units > 0 ? 100 : perc) / 100 * 226); // Adjusted for visual
        document.getElementById('mainRing').style.strokeDashoffset = offset;
    }

    function resetGrams() { currentX = 0; state.grams = 0; updateUI(); }

    function saveFavorite() {
        if(state.grams === 0) return;
        state.favorites.unshift({ 
            id: Date.now(), 
            grams: state.grams, 
            foodName: db[state.food].name, 
            emoji: db[state.food].emoji 
        });
        renderFavorites();
    }

    function renderFavorites() {
        const list = document.getElementById('favoritesList');
        const zone = document.getElementById('drop-delete-zone');
        list.innerHTML = state.favorites.length ? '' : '<p class="text-[9px] text-slate-400 italic ml-2">Nessun salvataggio...</p>';

        state.favorites.forEach(f => {
            const item = document.createElement('div');
            item.className = "bg-white shadow-sm rounded-2xl p-3 flex-shrink-0 text-center border border-slate-100 min-w-[70px] touch-none";
            item.innerHTML = `<span class="text-xl block">${f.emoji}</span><span class="text-[10px] font-black">${f.grams}g</span>`;
            
            let startY = 0, moveY = 0;
            item.ontouchstart = (e) => { startY = e.touches[0].clientY; zone.classList.add('visible'); };
            item.ontouchmove = (e) => {
                moveY = e.touches[0].clientY - startY;
                if(moveY < 0) item.style.transform = `translateY(${moveY}px)`;
            };
            item.ontouchend = (e) => {
                zone.classList.remove('visible');
                if(moveY < -60) {
                    state.favorites = state.favorites.filter(x => x.id !== f.id);
                    renderFavorites();
                } else {
                    item.style.transform = 'translateY(0)';
                }
            };
            list.appendChild(item);
        });
    }

    init();
  </script>
</body>
</html>
