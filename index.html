<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#f59e0b">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>PesoSenzaBilancia - Chef Academy</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        
        :root {
            --primary: #f59e0b;
            --primary-dark: #d97706;
            --bg-gradient: linear-gradient(135deg, #f1f5f9 0%, #cbd5e1 100%);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg-gradient);
            color: #1e293b;
            min-height: 100vh;
            user-select: none;
        }

        .main-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }

        .chef-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            position: relative;
            overflow: hidden;
        }

        .xp-bar-inner { transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }

        .mode-btn.active { background: white; color: var(--primary-dark); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }

        .selectable-card.active { border-color: var(--primary); background: #fffbeb; }

        @keyframes pulse-gold {
            0% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(245, 158, 11, 0); }
            100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0); }
        }
        .level-up-glow { animation: pulse-gold 2s infinite; }

        .trivia-card {
            border: 2px dashed #e2e8f0;
            transition: all 0.4s ease;
        }
        .trivia-card.completed { opacity: 0.6; pointer-events: none; transform: scale(0.98); }

        #customSelectOptions {
            max-height: 0; opacity: 0; overflow: hidden; transition: all 0.3s ease-out;
        }
        #customSelectOptions.open { max-height: 300px; opacity: 1; overflow-y: auto; }

        .option-btn.selected { border-color: #6366f1; background-color: #eef2ff; }
    </style>
</head>
<body class="flex items-center justify-center p-4 sm:p-8">

    <div class="main-card w-full max-w-[460px] rounded-[3rem] overflow-hidden relative">
        
        <!-- Identity Header -->
        <div class="chef-card p-6 text-white border-b border-white/5">
            <div class="flex items-center space-x-5">
                <div id="rankContainer" class="relative group">
                    <div id="levelGlow" class="absolute inset-0 bg-amber-500/20 rounded-2xl blur-xl opacity-0 transition-opacity duration-500"></div>
                    <div class="w-20 h-20 rounded-2xl bg-slate-800 border border-white/10 flex items-center justify-center text-4xl shadow-inner relative z-10 overflow-hidden">
                        <!-- Icona App Principale Corretta -->
                        <img id="rankImage" src="https://img.icons8.com/fluency/96/chef-hat.png" alt="Grado" class="w-14 h-14 object-contain">
                    </div>
                </div>
                <div class="flex-1">
                    <div class="flex justify-between items-end mb-1">
                        <div>
                            <h2 id="rankTitle" class="text-xl font-900 tracking-tighter text-amber-500 leading-none uppercase">AIUTO CUOCO</h2>
                            <p class="text-[10px] text-slate-400 font-bold uppercase tracking-[0.2em] mt-1">Livello Chef <span id="levelLabel">1</span></p>
                        </div>
                        <span id="xpLabel" class="text-[10px] font-900 text-slate-500">0/100 XP</span>
                    </div>
                    <div class="w-full bg-slate-800 h-2 rounded-full overflow-hidden">
                        <div id="xpBar" class="xp-bar-inner h-full bg-gradient-to-r from-amber-500 to-orange-400 w-0"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Conversione Header -->
        <div class="bg-white p-6 pb-2">
            <div class="inline-flex bg-slate-100 p-1 rounded-2xl w-full mb-6">
                <button onclick="setMode('toWeight')" id="tab-toWeight" class="mode-btn active flex-1 py-3 text-[10px] font-900 uppercase rounded-xl text-slate-500 transition-all">
                    Utensile ‚Üí Grammi
                </button>
                <button onclick="setMode('toTool')" id="tab-toTool" class="mode-btn flex-1 py-3 text-[10px] font-900 uppercase rounded-xl text-slate-500 transition-all">
                    Grammi ‚Üí Utensile
                </button>
            </div>

            <!-- Selezione Cibo -->
            <div id="customSelectTrigger" onclick="toggleDropdown()" class="w-full bg-slate-50 border-2 border-transparent rounded-2xl px-5 py-4 text-slate-700 font-bold flex items-center justify-between cursor-pointer hover:bg-white hover:border-amber-200 transition-all shadow-sm mb-6">
                <div class="flex items-center space-x-3">
                    <span id="selectedIcon" class="text-xl">üåæ</span>
                    <span id="selectedText">Farina</span>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-300" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
            </div>
            <div id="customSelectOptions" class="absolute z-50 left-6 right-6 mt-[-1rem] bg-white border border-slate-100 shadow-2xl rounded-2xl overflow-hidden"></div>
        </div>

        <div class="p-6 pt-0 space-y-4">
            <!-- Utensili Grid -->
            <div class="grid grid-cols-4 gap-2">
                <button onclick="selectTool('cucchiaio')" id="btn-cucchiaio" class="selectable-card active flex flex-col items-center justify-center p-3 rounded-2xl border-2 border-slate-50">
                    <img src="https://img.icons8.com/fluency/48/spoon.png" class="w-8 h-8 mb-1">
                    <span class="text-[8px] font-800 uppercase">Cucchiaio</span>
                </button>
                <button onclick="selectTool('cucchiaino')" id="btn-cucchiaino" class="selectable-card flex flex-col items-center justify-center p-3 rounded-2xl border-2 border-slate-50">
                    <!-- Icona Cucchiaino Corretta -->
                    <img src="https://img.icons8.com/fluency/48/tea-spoon.png" class="w-7 h-7 mb-1">
                    <span class="text-[8px] font-800 uppercase">Cucchiaino</span>
                </button>
                <button onclick="selectTool('tazzina')" id="btn-tazzina" class="selectable-card flex flex-col items-center justify-center p-3 rounded-2xl border-2 border-slate-50">
                    <span class="text-xl mb-1">‚òï</span>
                    <span class="text-[8px] font-800 uppercase">Tazzina</span>
                </button>
                <button onclick="selectTool('bicchiere')" id="btn-bicchiere" class="selectable-card flex flex-col items-center justify-center p-3 rounded-2xl border-2 border-slate-50">
                    <span class="text-xl mb-1">ü•õ</span>
                    <span class="text-[8px] font-800 uppercase">Bicchiere</span>
                </button>
            </div>

            <!-- Input & Risultato Principale -->
            <div class="flex items-center space-x-4">
                <div class="flex-1 bg-slate-50 p-4 rounded-3xl border border-slate-100">
                    <input type="number" id="mainInput" value="1" class="w-full text-center text-4xl font-900 text-slate-800 bg-transparent border-none focus:ring-0 p-0">
                    <p id="inputLabel" class="text-[9px] font-800 text-slate-400 uppercase text-center mt-1 tracking-widest">Unit√†</p>
                </div>
                <div class="flex-1 bg-amber-500 p-4 rounded-3xl shadow-lg shadow-amber-200 text-white text-center">
                    <div id="mainResult" class="text-4xl font-900 tracking-tighter">0g</div>
                    <p id="kcalResult" class="text-[10px] font-800 text-white/90 uppercase tracking-widest mt-0.5">0 KCAL</p>
                </div>
            </div>

            <!-- Dashboard Valori Nutrizionali -->
            <div class="bg-slate-900 rounded-[2rem] p-5 text-white">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-[10px] font-900 text-amber-500 uppercase tracking-widest">Macro-Nutrienti</h3>
                    <div class="h-[1px] flex-1 bg-slate-700 mx-4"></div>
                    <span class="text-[8px] text-slate-500 uppercase font-bold">Dati medi / 100g</span>
                </div>
                <div class="grid grid-cols-3 gap-4">
                    <div class="text-center">
                        <div id="carbsValue" class="text-lg font-900 text-white leading-none">0g</div>
                        <p class="text-[8px] text-slate-400 font-800 uppercase mt-1 tracking-wider">Carboidrati</p>
                        <div class="w-full bg-slate-800 h-1 mt-2 rounded-full overflow-hidden">
                            <div id="carbsBar" class="h-full bg-blue-400 w-0 transition-all duration-500"></div>
                        </div>
                    </div>
                    <div class="text-center">
                        <div id="proteinValue" class="text-lg font-900 text-white leading-none">0g</div>
                        <p class="text-[8px] text-slate-400 font-800 uppercase mt-1 tracking-wider">Proteine</p>
                        <div class="w-full bg-slate-800 h-1 mt-2 rounded-full overflow-hidden">
                            <div id="proteinBar" class="h-full bg-red-400 w-0 transition-all duration-500"></div>
                        </div>
                    </div>
                    <div class="text-center">
                        <div id="fatsValue" class="text-lg font-900 text-white leading-none">0g</div>
                        <p class="text-[8px] text-slate-400 font-800 uppercase mt-1 tracking-wider">Grassi</p>
                        <div class="w-full bg-slate-800 h-1 mt-2 rounded-full overflow-hidden">
                            <div id="fatsBar" class="h-full bg-yellow-400 w-0 transition-all duration-500"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quiz & Sfida Arricchito -->
            <div id="triviaContainer" class="trivia-card p-5 rounded-[2rem] bg-slate-50 relative overflow-hidden">
                <div id="triviaContent">
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-[9px] font-900 text-indigo-600 uppercase tracking-widest">Quiz dello Chef</span>
                        <span class="bg-indigo-100 text-indigo-600 text-[8px] px-2 py-0.5 rounded-full font-bold">+50 XP</span>
                    </div>
                    <p id="triviaQuestion" class="text-xs font-bold text-slate-700 mb-4 leading-snug"></p>
                    <div id="triviaOptions" class="grid grid-cols-1 gap-2 mb-4"></div>
                    <button id="confirmTriviaBtn" onclick="confirmTrivia()" class="w-full bg-indigo-600 text-white py-3 rounded-2xl text-[10px] font-900 uppercase tracking-widest shadow-lg shadow-indigo-100 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
                        Invia Risposta
                    </button>
                </div>
                <!-- Feedback Overlay -->
                <div id="triviaFeedback" class="hidden flex flex-col items-center justify-center text-center animate-in fade-in zoom-in duration-300">
                    <div id="feedbackIcon" class="text-4xl mb-2"></div>
                    <h4 id="feedbackTitle" class="text-sm font-900 uppercase tracking-tighter mb-1"></h4>
                    <p id="feedbackText" class="text-[10px] text-slate-500 font-medium px-4"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Database Arricchito con Macronutrienti (per 100g)
        const db = {
            farina: { icon: "üåæ", name: "Farina", weights: { cucchiaio: 12, cucchiaino: 4, tazzina: 60, bicchiere: 120 }, kcal: 364, c: 76, p: 10, f: 1 },
            olio: { icon: "ü´í", name: "Olio", weights: { cucchiaio: 9, cucchiaino: 3, tazzina: 80, bicchiere: 180 }, kcal: 884, c: 0, p: 0, f: 99 },
            zucchero: { icon: "üç¨", name: "Zucchero", weights: { cucchiaio: 15, cucchiaino: 5, tazzina: 80, bicchiere: 180 }, kcal: 387, c: 100, p: 0, f: 0 },
            sale: { icon: "üßÇ", name: "Sale", weights: { cucchiaio: 18, cucchiaino: 6, tazzina: 110, bicchiere: 250 }, kcal: 0, c: 0, p: 0, f: 0 },
            latte: { icon: "ü•õ", name: "Latte", weights: { cucchiaio: 15, cucchiaino: 5, tazzina: 70, bicchiere: 200 }, kcal: 42, c: 5, p: 3.4, f: 1.6 },
            riso: { icon: "üçö", name: "Riso", weights: { cucchiaio: 18, cucchiaino: 6, tazzina: 85, bicchiere: 160 }, kcal: 360, c: 80, p: 7, f: 0.6 }
        };

        const ranks = [
            { title: "AIUTO CUOCO", img: "https://img.icons8.com/fluency/96/cooking-pot.png" },
            { title: "CAPO PARTITA", img: "https://img.icons8.com/fluency/96/frying-pan.png" },
            { title: "SOUS CHEF", img: "https://img.icons8.com/fluency/96/chef-hat.png" },
            { title: "EXECUTIVE CHEF", img: "https://img.icons8.com/fluency/96/restaurant.png" },
            { title: "MASTER CHEF", img: "https://img.icons8.com/fluency/96/michelin-star.png" }
        ];

        const triviaQuestions = [
            { q: "Quante calorie fornisce 1g di grassi?", a: ["4 kcal", "7 kcal", "9 kcal"], c: 2, e: "I grassi sono i macronutrienti pi√π densi: 9 kcal per grammo." },
            { q: "Qual √® il macronutriente principale della farina?", a: ["Proteine", "Carboidrati", "Grassi"], c: 1, e: "La farina √® composta principalmente da amidi (carboidrati complessi)." },
            { q: "Quante calorie hanno 100g di sale?", a: ["0 kcal", "50 kcal", "10 kcal"], c: 0, e: "Il sale √® un minerale e non fornisce energia calorica." },
            { q: "Quale olio ha pi√π calorie?", a: ["Oliva", "Girasole", "Tutti uguali"], c: 2, e: "Tutti i grassi puri hanno circa lo stesso apporto calorico: 9 kcal/g." }
        ];

        // State
        let userState = { xp: 0, level: 1, dailyTriviaDone: false };
        let currentMode = 'toWeight', currentTool = 'cucchiaio', currentFoodKey = 'farina';
        let selectedTriviaOption = null;
        let currentQuestionObj = null;

        function init() {
            const container = document.getElementById('customSelectOptions');
            Object.keys(db).forEach(key => {
                const div = document.createElement('div');
                div.className = "px-6 py-4 flex items-center space-x-3 cursor-pointer border-b border-slate-50 hover:bg-slate-50 transition-colors";
                div.innerHTML = `<span class="text-xl">${db[key].icon}</span> <span class="text-sm font-bold text-slate-700">${db[key].name}</span>`;
                div.onclick = () => selectFood(key);
                container.appendChild(div);
            });
            loadDailyTrivia();
            updateXP(0);
            calculate();
        }

        // Gamification Logic
        function addXP(amount) {
            userState.xp += amount;
            if (userState.xp >= 100) {
                userState.xp = 0;
                userState.level++;
                triggerLevelUp();
            }
            updateXP();
        }

        function updateXP() {
            document.getElementById('xpBar').style.width = userState.xp + '%';
            document.getElementById('xpLabel').textContent = `${userState.xp}/100 XP`;
            document.getElementById('levelLabel').textContent = userState.level;
            
            const rIdx = Math.min(ranks.length - 1, Math.floor((userState.level - 1) / 2));
            const rank = ranks[rIdx];
            document.getElementById('rankTitle').textContent = rank.title;
            // Nota: rankImage resta fisso se non vogliamo cambiare hat a ogni livello, 
            // ma qui seguiamo la progressione del rankTitle.
        }

        function triggerLevelUp() {
            const glow = document.getElementById('levelGlow');
            glow.style.opacity = '1';
            document.getElementById('rankContainer').classList.add('level-up-glow');
            setTimeout(() => {
                glow.style.opacity = '0';
                document.getElementById('rankContainer').classList.remove('level-up-glow');
            }, 3000);
        }

        // Calculation Logic
        function toggleDropdown() { document.getElementById('customSelectOptions').classList.toggle('open'); }
        
        function selectFood(key) {
            currentFoodKey = key;
            document.getElementById('selectedIcon').textContent = db[key].icon;
            document.getElementById('selectedText').textContent = db[key].name;
            document.getElementById('customSelectOptions').classList.remove('open');
            addXP(2);
            calculate();
        }

        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.toggle('active', b.id === `tab-${mode}`));
            calculate();
        }

        function selectTool(tool) {
            currentTool = tool;
            document.querySelectorAll('.selectable-card').forEach(b => b.classList.toggle('active', b.id === `btn-${tool}`));
            calculate();
        }

        function calculate() {
            const food = db[currentFoodKey];
            const val = parseFloat(document.getElementById('mainInput').value) || 0;
            const uw = food.weights[currentTool];

            let weightG = 0;
            if (currentMode === 'toWeight') {
                weightG = Math.round(uw * val);
                document.getElementById('mainResult').textContent = weightG + 'g';
            } else {
                weightG = val;
                const units = (val / uw).toFixed(1);
                document.getElementById('mainResult').textContent = units + 'u';
            }

            const ratio = weightG / 100;
            const kcalTotal = Math.round(food.kcal * ratio);
            const carbsTotal = (food.c * ratio).toFixed(1);
            const proteinTotal = (food.p * ratio).toFixed(1);
            const fatsTotal = (food.f * ratio).toFixed(1);

            document.getElementById('kcalResult').textContent = kcalTotal + ' KCAL';
            
            document.getElementById('carbsValue').textContent = carbsTotal + 'g';
            document.getElementById('proteinValue').textContent = proteinTotal + 'g';
            document.getElementById('fatsValue').textContent = fatsTotal + 'g';

            document.getElementById('carbsBar').style.width = Math.min(100, (food.c)) + '%';
            document.getElementById('proteinBar').style.width = Math.min(100, (food.p * 2)) + '%'; 
            document.getElementById('fatsBar').style.width = Math.min(100, (food.f)) + '%';
        }

        // Trivia Logic
        function loadDailyTrivia() {
            currentQuestionObj = triviaQuestions[Math.floor(Math.random() * triviaQuestions.length)];
            document.getElementById('triviaQuestion').textContent = currentQuestionObj.q;
            const optCont = document.getElementById('triviaOptions');
            optCont.innerHTML = '';
            
            currentQuestionObj.a.forEach((ans, idx) => {
                const btn = document.createElement('button');
                btn.className = "option-btn w-full text-left p-3 rounded-xl bg-white border border-slate-200 text-[11px] font-bold text-slate-600 hover:border-indigo-300 transition-all";
                btn.textContent = ans;
                btn.onclick = () => {
                    selectedTriviaOption = idx;
                    document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                };
                optCont.appendChild(btn);
            });
        }

        function confirmTrivia() {
            if (selectedTriviaOption === null || userState.dailyTriviaDone) return;
            
            userState.dailyTriviaDone = true;
            const content = document.getElementById('triviaContent');
            const feedback = document.getElementById('triviaFeedback');
            const fIcon = document.getElementById('feedbackIcon');
            const fTitle = document.getElementById('feedbackTitle');
            const fText = document.getElementById('feedbackText');
            const container = document.getElementById('triviaContainer');

            content.classList.add('hidden');
            feedback.classList.remove('hidden');
            feedback.classList.add('flex');

            if (selectedTriviaOption === currentQuestionObj.c) {
                fIcon.textContent = "‚≠êÔ∏è";
                fTitle.textContent = "Eccellente!";
                fTitle.className = "text-sm font-900 uppercase tracking-tighter mb-1 text-green-600";
                fText.textContent = "Risposta corretta. " + currentQuestionObj.e;
                container.classList.add('bg-green-50', 'border-green-200');
                addXP(50);
            } else {
                fIcon.textContent = "üë®‚Äçüç≥";
                fTitle.textContent = "Quasi Corretto...";
                fTitle.className = "text-sm font-900 uppercase tracking-tighter mb-1 text-orange-500";
                fText.innerHTML = `La risposta corretta era: <span class="font-bold text-slate-700">${currentQuestionObj.a[currentQuestionObj.c]}</span>.<br>${currentQuestionObj.e}`;
                container.classList.add('bg-orange-50', 'border-orange-200');
            }

            // Svanisce dopo 6 secondi o resta come stato completato
            setTimeout(() => {
                container.classList.add('completed');
            }, 6000);
        }

        document.getElementById('mainInput').addEventListener('input', calculate);
        window.onload = init;
    </script>
</body>
</html>
